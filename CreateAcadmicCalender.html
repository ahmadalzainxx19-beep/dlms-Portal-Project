<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅูุดุงุก ูุชุฌููุฒ ุชูููู ุฃูุงุฏููู - KAU</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Cairo & Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/styles.css">
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#005941',
                        accent: '#C89933',
                    },
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        english: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Additional page-specific styles */
        input[type="date"] { direction: ltr; text-align: right; }
        .duration-input { width: 80px; text-align: center; font-weight: bold; color: var(--color-primary); }
        .badge-suspension {
            background-color: #dc3545 !important;
            color: #fff !important;
            font-weight: 900;
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-block;
            font-size: 0.85rem;
            box-shadow: 0 2px 5px rgba(220, 53, 69, 0.3);
        }
        .table-periods th { background-color: #f8f9fa !important; color: #495057; font-weight: 800; font-size: 0.8rem; }
    </style>
</head>
<body class="h-full flex overflow-hidden">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar w-64 flex-col hidden lg:flex h-full fixed lg:relative z-30">
        <div class="h-20 flex items-center justify-center border-b border-white/10">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-primary font-bold border-2 border-accent">KAU</div>
                <h1 class="text-white font-bold text-lg" data-ar="ุจูุงุจุฉ ุงูุฃูุธูุฉ" data-en="KAU Portal">ุจูุงุจุฉ ุงูุฃูุธูุฉ</h1>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
            <a href="index.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="index">
                <i data-feather="grid" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ููุญุฉ ุงูุชุญูู" data-en="Dashboard">ููุญุฉ ุงูุชุญูู</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุฅุฏุงุฑุฉ ุงููุจุงูู ูุงููุนุงูู" data-en="Buildings & Labs">ุฅุฏุงุฑุฉ ุงููุจุงูู ูุงููุนุงูู</div>
            <a href="buildings.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="buildings">
                <i data-feather="home" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฅุฏุงุฑุฉ ุงููุจุงูู" data-en="Buildings">ุฅุฏุงุฑุฉ ุงููุจุงูู</span>
            </a>
            <a href="labs.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="labs">
                <i data-feather="monitor" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฅุฏุงุฑุฉ ุงููุนุงูู" data-en="Labs">ุฅุฏุงุฑุฉ ุงููุนุงูู</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช" data-en="Exams">ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช</div>
            <a href="create-exam.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="create-exam">
                <i data-feather="file-text" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฌุฏููุฉ ุงุฎุชุจุงุฑ" data-en="Schedule Exam">ุฌุฏููุฉ ุงุฎุชุจุงุฑ</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุงูุชูููู ุงูุฃูุงุฏููู" data-en="Academic Calendar">ุงูุชูููู ุงูุฃูุงุฏููู</div>
            <a href="Calender-Mnagment.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="Calender-Mnagment">
                <i data-feather="settings" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฅุนุฏุงุฏุงุช ุงููุตูู ุงูุฏุฑุงุณูุฉ" data-en="Term Configurations">ุฅุนุฏุงุฏุงุช ุงููุตูู ุงูุฏุฑุงุณูุฉ</span>
            </a>
            <a href="AcadmicCalnder.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="AcadmicCalnder">
                <i data-feather="calendar" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุนุฑุถ ุงูุชูููู" data-en="View Calendar">ุนุฑุถ ุงูุชูููู</span>
            </a>
            <a href="view-archive-calendar.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="view-archive-calendar">
                <i data-feather="archive" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุงูุฃุฑุดูู" data-en="Archive">ุงูุฃุฑุดูู</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" data-en="Users">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</div>
            <a href="users.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="users">
                <i data-feather="users" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" data-en="User Management">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ" data-en="Finance">ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ</div>
            <a href="finance-sittings.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="finance-sittings">
                <i data-feather="dollar-sign" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุงูุฅุนุฏุงุฏุงุช ุงููุงููุฉ" data-en="Finance Settings">ุงูุฅุนุฏุงุฏุงุช ุงููุงููุฉ</span>
            </a>
            <a href="contracts-management.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="contracts-management">
                <i data-feather="file-text" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุฅุฏุงุฑุฉ ุงูุนููุฏ" data-en="Contracts">ุฅุฏุงุฑุฉ ุงูุนููุฏ</span>
            </a>
            
            <div class="pt-4 pb-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider" data-ar="ุงูุฅุนุฏุงุฏุงุช" data-en="Settings">ุงูุฅุนุฏุงุฏุงุช</div>
            <a href="setting.html" class="sidebar-link flex items-center px-4 py-3 rounded-lg group" data-page="setting">
                <i data-feather="settings" class="w-5 h-5 ms-3"></i>
                <span class="font-medium" data-ar="ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ" data-en="General Settings">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</span>
            </a>
        </nav>

        <div class="p-4 border-t border-white/10">
            <a href="Login.html" class="w-full flex items-center justify-center gap-2 text-red-300 hover:text-red-100 transition-colors">
                <i data-feather="log-out" class="w-4 h-4"></i>
                <span class="text-sm font-bold" data-ar="ุชุณุฌูู ุฎุฑูุฌ" data-en="Logout">ุชุณุฌูู ุฎุฑูุฌ</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
        <!-- Header -->
        <header class="sticky top-0 z-20 card-bg border-b border-custom shadow-sm">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center gap-4">
                    <button id="sidebarToggle" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-feather="menu" class="w-5 h-5"></i>
                    </button>
                    <div>
                        <h2 class="text-xl font-bold" data-ar="ุชุฌููุฒ ุงูุชูููู ุงูุฃูุงุฏููู ูุงูุฌุฏููุฉ" data-en="Academic Calendar Setup & Scheduling">ุชุฌููุฒ ุงูุชูููู ุงูุฃูุงุฏููู ูุงูุฌุฏููุฉ</h2>
                        <p class="text-sm text-muted" data-ar="ุฅุนุฏุงุฏ ุงููุทุงูุงุช ูุงูููุงุนูุฏ ุจูุงุกู ุนูู ุชูููู ุงูุฌุงูุนุฉ ุงูุฑุณูู" data-en="Setup ranges and dates based on official university calendar">ุฅุนุฏุงุฏ ุงููุทุงูุงุช ูุงูููุงุนูุฏ ุจูุงุกู ุนูู ุชูููู ุงูุฌุงูุนุฉ ุงูุฑุณูู</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button class="px-4 py-2 rounded-lg text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors me-3" onclick="showUniCalendarModal()">
                        <i data-feather="calendar" class="w-4 h-4 inline me-1"></i> <span data-ar="ุนุฑุถ ุงูุชูููู ุงูุฌุงูุนู ุงูุนุงู" data-en="View University Calendar">ุนุฑุถ ุงูุชูููู ุงูุฌุงูุนู ุงูุนุงู</span>
                    </button>
                    <button class="header-icon-hover p-2 rounded-lg transition-colors" id="themeToggle">
                        <i data-feather="moon" class="w-5 h-5"></i>
                    </button>
                    <button class="header-icon-hover p-2 rounded-lg transition-colors" id="langToggle">
                        <i data-feather="globe" class="w-5 h-5"></i>
                    </button>
                    <div class="flex items-center gap-2 ps-4 border-s border-custom">
                        <div class="text-end">
                            <div class="font-semibold" data-ar="ุฏ. ูููู ุงูุนูุงุฏุฉ" data-en="Dr. Vice Dean">ุฏ. ูููู ุงูุนูุงุฏุฉ</div>
                            <small class="text-muted text-xs" data-ar="ูุฏูุฑ ูุธุงู" data-en="System Admin">ูุฏูุฑ ูุธุงู</small>
                        </div>
                        <div class="w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-bold">VD</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto main-content-full-width">
            <div class="w-full p-6">
            <div class="bg-yellow-50 dark:bg-yellow-900/20 border-r-4 border-yellow-400 dark:border-yellow-600 rounded-lg p-4 mb-6 shadow-sm flex items-start gap-3">
                <i data-feather="info" class="w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"></i>
                <div><strong>ุชูุจูู ุงููุธุงู:</strong> ูุงูุฉ ุงูุชูุงุฑูุฎ ูุฌุจ ุฃู ุชููู <strong>ุฏุงุฎู ูุทุงู</strong> ุงูุจุฑูุงูุฌ ุงูุฏุฑุงุณู.</div>
            </div>

            <form id="calendarForm">
                <!-- 1. ุงูุชุตููู ูุงููุทุงู ุงูุฏุฑุงุณู ูุงูุฑุจุท ูุน ุจูุฑ -->
                <div class="card-bg rounded-xl shadow-lg border border-custom border-t-4 border-t-primary mb-6">
                    <div class="p-6 border-b border-custom flex items-center gap-2">
                        <i data-feather="sliders" class="w-5 h-5 text-primary"></i>
                        <span class="font-bold text-lg">1. ุงูุชุตููู ุงูุฏุฑุงุณู ูุงูุฑุจุท ูุน ุจูุฑ (Banner)</span>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">ุงููุตู ุงูุฏุฑุงุณู <span class="text-red-600">*</span></label>
                                <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" id="semesterSelect" required onchange="autoSyncBanner(this.value)">
                                    <option selected disabled>ุงุฎุชุฑ ุงููุตู ููุณุญุจ ุงูุชููุงุฆู...</option>
                                    <option value="1">ุงููุตู ุงูุฏุฑุงุณู ุงูุฃูู 1447ูู</option>
                                    <option value="2">ุงููุตู ุงูุฏุฑุงุณู ุงูุซุงูู 1447ูู</option>
                                    <option value="S">ุงููุตู ุงูุตููู 1447ูู</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-muted">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงููุตู ุงูุฑุณูู (ูู ุจูุฑ)</label>
                                <input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100" id="officialTermStart" readonly style="direction: ltr; text-align: right;">
                                <div id="syncBadge" class="official-date-badge mt-2 text-xs text-green-600"><i data-feather="check-circle" class="w-3 h-3 inline me-1"></i> ุชู ุงูุณุญุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ุงูุจุฑูุงูุฌ ุงูุฏุฑุงุณู <span class="text-red-600">*</span></label>
                                <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                    <option>ุจูุงููุฑููุณ</option><option>ุฏุจููู</option><option>ูุงุฌุณุชูุฑ</option><option>ุฏูุชูุฑุงุฉ</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 border-t border-custom pt-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">ููุน ุงูุชุนููู <span class="text-red-600">*</span></label>
                                <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                    <option>ุงูุชุธุงู</option><option>ุชุนููู ุนู ุจุนุฏ</option><option>ุงูุชุณุงุจ</option><option>ูุฏูุฌ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ุงูุดุทุฑ ุงูุชุนูููู</label>
                                <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"><option>ุงููู</option><option>ุทูุงุจ</option><option>ุทุงูุจุงุช</option></select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border-t border-custom pt-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-green-600 font-bold">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุจุฑูุงูุฌ <span class="text-red-600">*</span></label>
                                <input type="date" class="w-full px-4 py-2.5 border border-green-500 dark:border-green-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent" id="progStartDate" required onchange="validateAllDates()" style="direction: ltr; text-align: right;">
                                <div id="startDateWarning" class="text-xs text-red-600 font-bold mt-1 hidden">โ๏ธ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุฌุจ ุฃู ูููู ุจุนุฏ 14 ููู ูู ุจุฏุงูุฉ ุงููุตู!</div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-green-600 font-bold">ุชุงุฑูุฎ ููุงูุฉ ุงูุจุฑูุงูุฌ <span class="text-red-600">*</span></label>
                                <input type="date" class="w-full px-4 py-2.5 border border-green-500 dark:border-green-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent" id="progEndDate" required onchange="validateAllDates()" style="direction: ltr; text-align: right;">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ุฅุฌูุงูู ุนุฏุฏ ุงูุฃุณุงุจูุน</label>
                                <input type="number" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-bold" id="weeksCount" readonly placeholder="ููุญุณุจ ุชููุงุฆูุงู">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. ุงูุฌุฏููุฉ ุงูุชููุงุฆูุฉ -->
                <div class="card-bg rounded-xl shadow-lg border border-custom border-t-4 border-t-blue-500 mb-6">
                    <div class="p-6 border-b border-custom flex items-center gap-2">
                        <i data-feather="zap" class="w-5 h-5 text-blue-500"></i>
                        <span class="font-bold text-lg">2. ุฌุฏููุฉ ุงููุญุงุถุฑุงุช ุงูุชููุงุฆูุฉ</span>
                    </div>
                    <div class="p-6">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold mb-2">ูู ุณูุชู ุฌุฏููุฉ ุงููุญุงุถุฑุงุช ุชููุงุฆูุงู ููุฐุง ุงูุจุฑูุงูุฌุ</label>
                            <div class="flex gap-4">
                                <div class="flex items-center"><input class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" type="radio" name="autoSched" id="schedYes" value="yes" onchange="toggleScheduling(true)"><label class="ms-2 text-sm" for="schedYes">ูุนู</label></div>
                                <div class="flex items-center"><input class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" type="radio" name="autoSched" id="schedNo" value="no" onchange="toggleScheduling(false)" checked><label class="ms-2 text-sm" for="schedNo">ูุง</label></div>
                            </div>
                        </div>
                        <div id="schedulingLogic" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label class="block text-sm font-semibold mb-2">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุฌุฏููุฉ</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" id="schedStart" onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></div>
                                <div><label class="block text-sm font-semibold mb-2">ุชุงุฑูุฎ ููุงูุฉ ุงูุฌุฏููุฉ</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" id="schedEnd" onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></div>
                            </div>
                        </div>
                        <div id="schedUnavailable" class="text-sm text-muted"><i data-feather="alert-circle" class="w-4 h-4 inline me-2"></i> ูุฐู ุงูุฌุฏููุฉ ุบูุฑ ูุชุงุญุฉ ุขููุงู ุญุงููุงู.</div>
                    </div>
                </div>

                <!-- 3. ุงูุนููุฏ ูุงูููุงุนูุฏ ุงูููุงุฆูุฉ -->
                <div class="card-bg rounded-xl shadow-lg border border-custom border-t-4 border-t-gray-700 mb-6">
                    <div class="p-6 border-b border-custom flex items-center gap-2">
                        <i data-feather="file-text" class="w-5 h-5 text-gray-700"></i>
                        <span class="font-bold text-lg">3. ูุธุงู ุงูุนููุฏ ูุงูููุงุนูุฏ ุงูููุงุฆูุฉ</span>
                    </div>
                    <div class="p-6">
                        <div class="mb-6">
                            <label class="block text-sm font-semibold mb-2">ูู ูุชุทูุจ ุงูุจุฑูุงูุฌ ุชูููุน ุนูุฏ ุฅููุชุฑูููุ</label>
                            <div class="flex gap-4">
                                <div class="flex items-center"><input class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" type="radio" name="reqContract" id="contractYes" value="yes" onchange="toggleContract(true)"><label class="ms-2 text-sm" for="contractYes">ูุนู</label></div>
                                <div class="flex items-center"><input class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" type="radio" name="reqContract" id="contractNo" value="no" onchange="toggleContract(false)" checked><label class="ms-2 text-sm" for="contractNo">ูุง</label></div>
                            </div>
                        </div>
                        <div id="contractLogic" class="hidden mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div><label class="block text-sm font-semibold mb-2">ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุชูููุน</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" id="contractStart" onchange="validateContractDates(this)" style="direction: ltr; text-align: right;"></div>
                                <div><label class="block text-sm font-semibold mb-2">ุชุงุฑูุฎ ููุงูุฉ ุงูุชูููุน</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" id="contractEnd" onchange="validateContractDates(this)" style="direction: ltr; text-align: right;"></div>
                                <div><label class="block text-sm font-semibold mb-2 text-primary">ูุฏุฉ ุฅุชุงุญุฉ ุงูุนููุฏ (ููู)</label><input type="text" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-bold text-center" id="contractDuration" readonly></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-custom pt-6">
                            <div><label class="block text-sm font-semibold mb-2">ุขุฎุฑ ููุนุฏ ูุงุญุชุณุงุจ ุงูุฃูุดุทุฉ</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" required onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></div>
                            <div><label class="block text-sm font-semibold mb-2">ุขุฎุฑ ููุนุฏ ูุงุญุชุณุงุจ ุงููุญุงุถุฑุงุช</label><input type="date" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent date-bound" required onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></div>
                        </div>
                    </div>
                </div>

                <!-- 4. ุงููุชุฑุงุช ุงูุงุณุชุซูุงุฆูุฉ - ุชุนุฏูู ุจุทูุจู ูุง ุฑูุณ -->
                <!-- <div class="card border-top border-3 border-danger shadow-sm">
                    <div class="card-header bg-white">
                        <div class="d-flex justify-content-between align-items-center w-100">
                            <span><i class="fas fa-umbrella-beach text-danger me-2"></i> 4. ุฅุฏุงุฑุฉ ุงููุชุฑุงุช ุงูุงุณุชุซูุงุฆูุฉ ูุงูุฅุฌุงุฒุงุช</span>
                            <button type="button" class="btn btn-sm btn-outline-danger shadow-sm fw-bold" onclick="addNewPeriodRow()">
                                <i class="fas fa-plus me-1"></i> ุฅุถุงูุฉ ูุชุฑุฉ ุงุณุชุซูุงุฆูุฉ ุฌุฏูุฏุฉ
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0 table-periods" id="periodsTable">
                                <thead class="table-light">
                                    <tr class="small text-center">
                                        <th class="ps-4 text-start">ููุน ุงูุญุฏุซ / ูุณูู ุงููุชุฑุฉ</th>
                                        <th>ูู ุชุงุฑูุฎ</th>
                                        <th>ุฅูู ุชุงุฑูุฎ</th>
                                        <th>ุชุฃุซูุฑ ุงูุญุถูุฑ ุงููุงูู (ุฏูููุฉ)</th>
                                        <th>ุฅุฌุฑุงุก</th>
                                    </tr>
                                </thead>
                                <tbody id="periodsTableBody">
                                    <tr class="period-row text-center">
                                        <td class="ps-4 text-start">
                                            <span class="fw-bold"><i class="fas fa-flag me-1 text-success"></i> ุงูููู ุงููุทูู ุงูุณุนูุฏู</span>
                                        </td>
                                        <td><input type="date" class="form-control form-control-sm border-0 bg-transparent" value="2025-09-23" readonly></td>
                                        <td><input type="date" class="form-control form-control-sm border-0 bg-transparent" value="2025-09-23" readonly></td>
                                        <td><span class="badge-suspension">ุชุนููู ููู ููุฏุฑุงุณุฉ</span></td>
                                        <td><i class="fas fa-lock text-muted"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div> -->

                <div class="flex justify-end gap-3 mt-6 mb-8">
                    <button type="button" class="px-6 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" onclick="window.location.href='AcadmicCalnder.html'">ุฅูุบุงุก</button>
                    <button type="submit" class="btn-primary px-6 py-2.5 shadow-sm"><i data-feather="save" class="w-4 h-4 inline me-2"></i> ุญูุธ ูุณูุฏุฉ ููุงุนุชูุงุฏ</button>
                </div>
            </form>

            </div>

        </main>

        <!-- Footer -->
        <footer class="p-4 border-t border-custom text-center text-muted text-sm card-bg flex-shrink-0">
            <div id="liveDateTime" class="font-bold text-primary mb-1 font-english" style="direction: ltr;"></div>
            <div data-ar="ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2026 ู. ุฃุญูุฏ ูููุจุงู | ุฑูู ุงูุฅุตุฏุงุฑ: 2.0" data-en="All rights reserved ยฉ 2026 Eng. Ahmed Filban | Version: 2.0">ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2026 ู. ุฃุญูุฏ ูููุจุงู | ุฑูู ุงูุฅุตุฏุงุฑ: 2.0</div>
        </footer>
    </div>
</div>
</div>

<script>
    let uniCalendarModalVisible = false;
    
    function showUniCalendarModal() {
        Swal.fire({
            title: 'ุงูุชูููู ุงูุฌุงูุนู ุงูุฑุณูู',
            html: `
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-center">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="px-4 py-2">ุงูููุงุณุจุฉ</th>
                                <th class="px-4 py-2">ุงูุชุงุฑูุฎ</th>
                                <th class="px-4 py-2">ุงูููุน</th>
                                <th class="px-4 py-2">ุฅุฌุฑุงุก</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2">ุจุฏุงูุฉ ุงููุตู ุงูุซุงูู</td>
                                <td class="px-4 py-2">2026-01-15</td>
                                <td class="px-4 py-2">ุฃูุงุฏููู</td>
                                <td class="px-4 py-2">
                                    <button class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700" onclick="importOfficialDate('2026-01-15'); Swal.close();">ุงุณุชูุฑุงุฏ ูุจุฏุงูุฉ</button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2">ุฅุฌุงุฒุฉ ููู ุงูุชุฃุณูุณ</td>
                                <td class="px-4 py-2">2026-02-22</td>
                                <td class="px-4 py-2">ุฅุฌุงุฒุฉ</td>
                                <td class="px-4 py-2">
                                    <button class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700" onclick="importToPeriods('founding', 'ููู ุงูุชุฃุณูุณ', '2026-02-22', '2026-02-22'); Swal.close();">ุฅุถุงูุฉ ููุฌุฏูู</button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2">ุจุฏุงูุฉ ุดูุฑ ุฑูุถุงู</td>
                                <td class="px-4 py-2">2026-02-18</td>
                                <td class="px-4 py-2">ูุชุฑุฉ ุฎุงุตุฉ</td>
                                <td class="px-4 py-2">
                                    <button class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700" onclick="importToPeriods('ramadan', 'ุฑูุถุงู', '2026-02-18', '2026-03-19'); Swal.close();">ุฅุถุงูุฉ (ุชุนุฏูู ููุช)</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `,
            width: '800px',
            showConfirmButton: false,
            showCancelButton: true,
            cancelButtonText: 'ุฅุบูุงู',
            cancelButtonColor: '#6c757d'
        });
    }
    
    function showCustomCaseModal() {
        Swal.fire({
            title: 'ุฅุฏุฎุงู ูุณูู ูุฎุตุต',
            html: `
                <div class="text-right">
                    <label class="block text-sm font-semibold mb-2">ูุง ูู ูุณูู ูุฐู ุงููุชุฑุฉ ุงูุงุณุชุซูุงุฆูุฉุ</label>
                    <input type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg" id="customCaseInput" placeholder="ูุซุงู: ุฃุณุจูุน ููุฉุ ุฅุฌุงุฒุฉ ุงูุฑุจูุน...">
                    <div class="text-xs text-muted mt-2">ุณูุชู ุญูุธ ุงููุณูู ูุงุฎุชูุงุฑู ูู ุงูุฌุฏูู ูุจุงุดุฑุฉ.</div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'ุญูุธ ูุงุฎุชูุงุฑ',
            cancelButtonText: 'ุฅูุบุงุก',
            confirmButtonColor: '#005941',
            cancelButtonColor: '#6c757d',
            reverseButtons: true,
            preConfirm: () => {
                const input = document.getElementById('customCaseInput');
                const name = input?.value.trim();
                if (!name) {
                    Swal.showValidationMessage('ุงูุชุจ ูุณูู ุงููุชุฑุฉ!');
                    return false;
                }
                return name;
            }
        }).then((result) => {
            if (result.isConfirmed && result.value) {
                saveCustomCase(result.value);
            } else {
                cancelCustomCase();
            }
        });
    }

    // ูุงุฆูุฉ ุงูุฎูุงุฑุงุช - ุชุจุฏุฃ ุจุฎูุงุฑ ูุงุฑุบ
    let eventOptions = [
        { id: 'placeholder', text: '( ---- )' },
        { id: 'ramadan', text: '๐ ุดูุฑ ุฑูุถุงู' },
        { id: 'hajj', text: '๐ ููุณู ุงูุญุฌ' },
        { id: 'rain', text: '๐ง๏ธ ุชุนููู (ูุทุฑ/ููุงุฎ)' },
        { id: 'national', text: '๐ธ๐ฆ ุงูููู ุงููุทูู' },
        { id: 'founding', text: '๐๏ธ ููู ุงูุชุฃุณูุณ' },
        { id: 'custom', text: 'โ๏ธ ุฃุฎุฑู' }
    ];

    let currentActiveSelect = null;

    function autoSyncBanner(val) {
        const displayField = document.getElementById('officialTermStart');
        const syncBadge = document.getElementById('syncBadge');
        let fakeDate = '2026-01-15'; if (val === "1") fakeDate = '2025-08-20'; if (val === "S") fakeDate = '2026-06-01';
        displayField.value = fakeDate; syncBadge.style.display = 'block'; validateAllDates();
    }

    function importOfficialDate(date) {
        document.getElementById('officialTermStart').value = date; 
        document.getElementById('syncBadge').classList.remove('hidden');
        validateAllDates();
    }

    function importToPeriods(cat, name, start, end) {
        if(!eventOptions.some(opt => opt.text.includes(name))) {
             const newId = 'imported_' + Date.now();
             eventOptions.splice(eventOptions.length - 1, 0, { id: newId, text: '๐ ' + name });
        }
        addNewPeriodRow(cat, start, end);
    }

    function toggleScheduling(show) { 
        const logic = document.getElementById('schedulingLogic');
        const unavailable = document.getElementById('schedUnavailable');
        if (show) {
            logic.classList.remove('hidden');
            unavailable.classList.add('hidden');
        } else {
            logic.classList.add('hidden');
            unavailable.classList.remove('hidden');
        }
    }
    function toggleContract(show) { 
        const logic = document.getElementById('contractLogic');
        if (show) {
            logic.classList.remove('hidden');
        } else {
            logic.classList.add('hidden');
        }
    }

    function validateContractDates(input) {
        validateDateInRange(input);
        const start = document.getElementById('contractStart').value; const end = document.getElementById('contractEnd').value;
        if (start && end) {
            const d1 = new Date(start); const d2 = new Date(end);
            if (d2 >= d1) document.getElementById('contractDuration').value = (Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24)) + 1) + " ููู";
            else document.getElementById('contractDuration').value = "ุฎุทุฃ";
        }
    }

    // ุฅุถุงูุฉ ุตู ุฌุฏูุฏ - ุตุงุฑ ูุถููู ุนูู ุงููุงุฑุบ
    function addNewPeriodRow(catId='placeholder', start='', end='') {
        const tbody = document.getElementById('periodsTableBody');
        const tr = document.createElement('tr');
        tr.className = 'period-row text-center';
        
        let optionsHtml = eventOptions.map(opt => `<option value="${opt.id}" ${catId===opt.id?'selected':''}>${opt.text}</option>`).join('');

        tr.innerHTML = `
            <td class="ps-4 text-start">
                <select class="w-full px-3 py-1.5 text-sm border border-primary rounded-lg font-bold event-cat-select" onchange="updatePeriodLogic(this)">
                    ${optionsHtml}
                </select>
            </td>
            <td><input type="date" class="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 date-bound" value="${start}" onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></td>
            <td><input type="date" class="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 date-bound" value="${end}" onchange="validateDateInRange(this)" style="direction: ltr; text-align: right;"></td>
            <td id="impactCell">
                <div class="flex items-center justify-center gap-2 duration-box">
                    <input type="number" class="w-20 px-2 py-1 text-sm text-center font-bold text-primary border border-gray-300 rounded duration-input" value="60">
                    <span class="text-xs text-muted">ุฏูููุฉ</span>
                </div>
                <div class="suspension-badge hidden"><span class="badge-suspension">ุชุนููู ููู ููุฏุฑุงุณุฉ</span></div>
            </td>
            <td><button type="button" class="px-2 py-1 text-red-600 hover:text-red-700" onclick="this.closest('tr').remove()"><i data-feather="trash-2" class="w-4 h-4"></i></button></td>
        `;
        setTimeout(() => feather.replace(), 100);
        tbody.appendChild(tr);
        // ูุง ูููุฐ updatePeriodLogic ููุง ุนุดุงู ูุง ูุทูุน ุงูููุฏุงู ููุฑุง
    }

    function updatePeriodLogic(select) {
        // ุงูููุฏุงู ูุทูุน ููุท ูู ุงุฎุชุงุฑ "ุฃุฎุฑู" ูุฏููุง
        if (select.value === 'custom') {
            currentActiveSelect = select;
            showCustomCaseModal();
            return;
        }

        const row = select.closest('tr');
        const dBox = row.querySelector('.duration-box');
        const sBadge = row.querySelector('.suspension-badge');
        const isHoliday = ['national', 'founding', 'rain'].includes(select.value);
        
        // ูู ุงุฎุชุงุฑ ุงููุฑุงุบ (----) ูุฑุฌุน ูู ุดู ุทุจูุนู
        if (select.value === 'placeholder') {
            dBox.classList.remove('hidden');
            sBadge.classList.add('hidden');
            row.querySelector('.duration-input').value = 60;
            return;
        }

        if (isHoliday) {
            dBox.classList.add('hidden');
            sBadge.classList.remove('hidden');
        } else {
            dBox.classList.remove('hidden');
            sBadge.classList.add('hidden');
            if (select.value === 'ramadan') row.querySelector('.duration-input').value = 40;
            else row.querySelector('.duration-input').value = 60;
        }
    }

    function saveCustomCase(name) {
        const newId = 'custom_' + Date.now();
        const newOption = { id: newId, text: 'โ๏ธ ' + name };
        
        // ุฅุถุงูุชู ูุจู "ุฃุฎุฑู"
        eventOptions.splice(eventOptions.length - 1, 0, newOption);

        document.querySelectorAll('.event-cat-select').forEach(sel => {
            const currentVal = sel.value;
            sel.innerHTML = eventOptions.map(opt => `<option value="${opt.id}" ${currentVal===opt.id?'selected':''}>${opt.text}</option>`).join('');
        });

        if (currentActiveSelect) {
            currentActiveSelect.value = newId;
            updatePeriodLogic(currentActiveSelect);
        }
    }

    function cancelCustomCase() {
        if (currentActiveSelect) currentActiveSelect.selectedIndex = 0;
    }

    function validateDateInRange(input) {
        const startBound = document.getElementById('progStartDate').value;
        const endBound = document.getElementById('progEndDate').value;
        if (!startBound || !endBound) return;
        const dCurrent = new Date(input.value);
        if (dCurrent < new Date(startBound) || dCurrent > new Date(endBound)) {
            Swal.fire({
                icon: 'warning',
                title: 'ุชูุจูู',
                text: 'ุงูุชุงุฑูุฎ ุฎุงุฑุฌ ูุทุงู ุงูุจุฑูุงูุฌ ุงูุฏุฑุงุณู!',
                confirmButtonText: 'ููุงูู',
                confirmButtonColor: '#ffc107'
            });
            input.value = "";
        }
    }

    function validateAllDates() {
        const officialStart = document.getElementById('officialTermStart').value;
        const progStart = document.getElementById('progStartDate').value;
        const progEnd = document.getElementById('progEndDate').value;
        const warning = document.getElementById('startDateWarning');
        if (officialStart && progStart) {
            const diffDays = (new Date(progStart) - new Date(officialStart)) / (1000 * 60 * 60 * 24);
            if (diffDays < 14) { 
                warning.classList.remove('hidden'); 
                document.getElementById('progStartDate').classList.add('border-red-500');
            } else { 
                warning.classList.add('hidden'); 
                document.getElementById('progStartDate').classList.remove('border-red-500');
            }
        }
        if (progStart && progEnd) {
            const d1 = new Date(progStart); const d2 = new Date(progEnd);
            if (d2 >= d1) document.getElementById('weeksCount').value = Math.round(Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24)) / 7);
        }
    }

    document.getElementById('calendarForm').onsubmit = function(e) {
        e.preventDefault(); 
        Swal.fire({
            icon: 'success',
            title: 'ุชู ุงูุญูุธ',
            text: 'ุชู ุญูุธ ุงููุณูุฏุฉ ุจูุฌุงุญ.',
            confirmButtonText: 'ููุงูู',
            confirmButtonColor: '#198754'
        }).then(() => {
            window.location.href = 'view-archive-calendar.html';
        });
    };

    function updateTime() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('liveDateTime').innerText = new Date().toLocaleDateString('ar-SA', options);
    }
    setInterval(updateTime, 1000); updateTime();
    
    // Initialize Feather Icons
    if (typeof feather !== 'undefined') {
        feather.replace();
    }
    
    // Set active page in sidebar
    (function() {
        const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
        const activeLink = document.querySelector(`[data-page="${currentPage}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
        
        // Sidebar Toggle for Mobile
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
            });
        }
    })();

    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    const themeIcon = themeToggle?.querySelector('i');
    
    // Check for saved theme preference
    const currentTheme = localStorage.getItem('theme') || 'light';
    if (currentTheme === 'dark') {
        html.classList.add('dark');
        if (themeIcon) themeIcon.setAttribute('data-feather', 'sun');
    }
    
    themeToggle?.addEventListener('click', () => {
        html.classList.toggle('dark');
        const isDark = html.classList.contains('dark');
        if (themeIcon) themeIcon.setAttribute('data-feather', isDark ? 'sun' : 'moon');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        feather.replace();
    });
    
    // Language Toggle
    let isArabic = true;
    const langToggle = document.getElementById('langToggle');
    langToggle?.addEventListener('click', () => {
        isArabic = !isArabic;
        document.documentElement.lang = isArabic ? 'ar' : 'en';
        document.documentElement.dir = isArabic ? 'rtl' : 'ltr';
        
        // Update all text elements
        document.querySelectorAll('[data-ar][data-en]').forEach(el => {
            el.textContent = isArabic ? el.getAttribute('data-ar') : el.getAttribute('data-en');
        });
        feather.replace();
    });
</script>
</body>
</html>